!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Blueprint={})}(this,(function(t){"use strict";var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,r)};function r(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}var i,o,s=function(t){function e(r){var i=t.call(this,"The key '"+r+"' is missing from the object to be converted.")||this;return i.name="MissingKeyError",Object.setPrototypeOf(i,e.prototype),i}return r(e,t),e}(Error),n=function(t){function e(r){var i=t.call(this,"'"+r+"' is not a valid modifier.")||this;return i.name="IllegalModifierError",Object.setPrototypeOf(i,e.prototype),i}return r(e,t),e}(Error);!function(t){t.MAYBE="maybe",t.OPTIONAL="optional"}(i||(i={})),function(t){t[t.ARRAY=0]="ARRAY",t[t.FACTORY=1]="FACTORY",t[t.PRIMITIVE=2]="PRIMITIVE"}(o||(o={}));var c=function(t){return!["number","boolean"].includes(typeof t)&&([Object,Array].includes((t||{}).constructor)&&!Object.entries(t||{}).length)},u=function(t,e){if(void 0===e&&(e=""),!t){if(e=["Assertion failed",e].join(": "),"undefined"!=typeof Error)throw new Error(e);throw e}};class a extends Function{constructor(t=null,e=!1){return super(),this.type=t,this.key=null,this.mutator=null,this.ejected=e,this.modifiers=[],new Proxy(this,{get:(t,e,r)=>{if(Reflect.has(t,e))return Reflect.get(t,e,r);if(o=i,s=e,Object.values(o).includes(s))return(t=t.eject()).addModifier(e),t;var o,s;if("string"==typeof e)throw new n(e)},apply:(t,e,r)=>(t=t.eject()).call(...r)})}call(...t){return t.length>0&&(t[0]instanceof a||t[0]instanceof Function)&&this.setType(t.shift()),t.length>0&&this.setKey(t.shift()),t.length>0&&this.setMutator(t.shift()),this}setType(t){return this.type=t,this.checkType(),this}setKey(t){return u("string"==typeof t,"Key should be a string, but it is not."),c(this.key)&&(this.key=t),this}setMutator(t){return u("function"==typeof t,"Mutator should be a function, but it is not."),this.mutator=t,this}addModifier(t){this.modifiers.push(t)}checkType(){u(!c(this.type),"Descriptor type is not set."),u(null!==this.descriptorTypeValue,"The type of the descriptor is not valid.")}get hasKey(){return null!==this.key}hasModifier(t){return this.modifiers.includes(t)}get descriptorTypeValue(){return[String,Boolean,Number].includes(this.type)?o.PRIMITIVE:this.type instanceof a?o.ARRAY:this.type instanceof Function?o.FACTORY:null}get hasMutator(){return"function"==typeof this.mutator}checkIsReady(){u(this.ejected,"Descriptor has not been ejected."),this.checkType()}eject(){return this.ejected?this:new a(this.type,!0)}}var h=Symbol("missing key");class p{constructor(t){return this.descriptor=t.eject(),this}extract(t){if(this.descriptor.checkIsReady(),"object"==typeof t&&!t.hasOwnProperty(this.descriptor.key)){if(this.descriptor.hasModifier(i.MAYBE))return null;if(this.descriptor.hasModifier(i.OPTIONAL))return h;throw new s(this.descriptor.key)}return this.convert(this.descriptor.hasKey?t[this.descriptor.key]:t)}convert(t){const e=this.applyMutator(this.caster);return this.descriptor.descriptorTypeValue===o.ARRAY||this.descriptor.descriptorTypeValue===o.FACTORY?t.map((t=>e(t))):e(t)}get caster(){return this.descriptor.descriptorTypeValue===o.ARRAY?t=>new p(this.descriptor.type).extract(t):this.descriptor.type}applyMutator(t){return this.descriptor.hasMutator?e=>t(this.descriptor.mutator(e)):t}makeNullValue(){return this.convert(this.descriptor.descriptorTypeValue===o.ARRAY?[]:"")}}class l{constructor(t={}){this.specification=t}make(t={}){const e={},r=c(t);return Object.entries(this.specification).forEach((([i,o])=>{(o=o.eject()).setKey(i);const s=new p(o);if(r)return void(e[i]=s.makeNullValue());s.extract(t)!==h&&(e[i]=s.extract(t))})),e}}const f=new a(String),y=new a(Number),d=new a(Boolean),b=new a,m=t=>new l(t);t.$Boolean=d,t.$Many=b,t.$Number=y,t.$String=f,t.Blueprint=l,t.IllegalModifierError=n,t.MissingKeyError=s,t.blueprint=m,t.factory=t=>e=>m(t).make(e),Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
