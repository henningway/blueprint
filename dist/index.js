!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Blueprint={})}(this,(function(e){"use strict";const t=function(e){return!["number","boolean"].includes(typeof e)&&([Object,Array].includes((e||{}).constructor)&&!Object.entries(e||{}).length)},r=function(e,t=""){if(!e){if(t=["Assertion failed",t].join(": "),"undefined"!=typeof Error)throw new Error(t);throw t}},s=class{constructor(e={}){return this.elements=e,new Proxy(this,{get:(e,t,r)=>Reflect.has(e,t)?Reflect.get(e,t,r):e.elements[t]})}has(e){return this.values.includes(e)}get values(){return Object.values(this.elements)}},i=class extends Error{constructor(e){super(`The key '${e}' is missing from the object to be converted.`),this.name="MissingKeyError"}},n=class extends Error{constructor(e=null){super(`'${e}' is not a valid modifier.`),this.name="IllegalModifierError"}},o=Symbol("missing key or value"),c=new s({MAYBE:"maybe",OPTIONAL:"optional"}),a=new s({ANY:"ANY",STRING:"STRING",NUMBER:"NUMBER",BOOLEAN:"BOOLEAN",ARRAY:"ARRAY"}),h=new s({PASS_THROUGH:"PASS_THROUGH",PRIMITIVE:"PRIMITIVE",DESCRIPTOR:"DESCRIPTOR",FACTORY:"FACTORY"});class u{constructor(e={}){this.specification=e}make(e={}){const r={},s=t(e);return Object.entries(this.specification).forEach((([t,i])=>{if("object"==typeof i)return void(r[t]=T(i).make(e[t]));const n=new l(i.eject().setKey(t));if(s)return void(r[t]=n.makeNullValue());const c=n.extract(e);c!==o&&(r[t]=c)})),r}}class l{constructor(e){return this.descriptor=e.eject(),this}extract(e){if(this.descriptor.checkIsReady(),"object"==typeof e&&!e.hasOwnProperty(this.descriptor.key)){if(this.descriptor.hasDefault)return this.descriptor.defaultValue;if(this.descriptor.hasModifier(c.MAYBE))return null;if(this.descriptor.hasModifier(c.OPTIONAL))return o;throw new i(this.descriptor.key)}return this.convert(this.descriptor.hasKey?e[this.descriptor.key]:e)}convert(e){if([null,void 0].includes(e)){if(this.descriptor.hasModifier(c.MAYBE))return null;if(this.descriptor.hasModifier(c.OPTIONAL))return o}const t=this.applyMutator(this.caster);return this.descriptor.type===a.ARRAY?e.map((e=>t(e))):t(e)}get caster(){return this.descriptor.casterType===h.DESCRIPTOR?e=>new l(this.descriptor.caster).extract(e):this.descriptor.caster}applyMutator(e){return this.descriptor.hasMutator?t=>e(this.descriptor.mutator(t)):e}makeNullValue(){const e=(()=>{if(this.descriptor.hasDefault)return this.descriptor.defaultValue;switch(this.descriptor.type){case a.ARRAY:return[];case a.ANY:return null;default:return""}})();return this.convert(e)}}class f extends Function{constructor(e,t,r=!1){switch(super(),this.type=e,this.defaultValue=t,this.ejected=r,this.key=null,this.caster=null,this.mutator=null,this.modifiers=[],e){case a.ANY:this.caster=e=>e;break;case a.STRING:this.caster=String;break;case a.NUMBER:this.caster=Number;break;case a.BOOLEAN:this.caster=Boolean}return new Proxy(this,{get:(e,t,r)=>{if(Reflect.has(e,t))return Reflect.get(e,t,r);if(c.has(t))return(e=e.eject()).addModifier(t),e;if("default"===t)return e=e.eject(),t=>(e.defaultValue=t,e);if("string"==typeof t)throw new n(t)},apply:(e,t,r)=>e.ejected?Reflect.apply(e,t,r):(e=e.eject()).call(...r)})}call(...e){return e.length>0&&(e[0]instanceof f||e[0]instanceof Function)&&this.setType(a.ARRAY).setCaster(e.shift()),e.length>0&&this.setKey(e.shift()),e.length>0&&this.setMutator(e.shift()),this}setType(e){return this.type=e,this.checkType(),this}setCaster(e){return this.caster=e,this.checkCaster(),this}setKey(e){return r("string"==typeof e,"Key should be a string, but it is not."),t(this.key)&&(this.key=e),this}setMutator(e){return r("function"==typeof e,"Mutator should be a function, but it is not."),this.mutator=e,this}addModifier(e){this.modifiers.push(e)}checkType(){r(!t(this.type),"Descriptor type is not set."),r(a.has(this.type),"The descriptor type is not valid.")}checkCaster(){r(!t(this.caster),"Caster is not set."),r(h.has(this.casterType),"The caster is not valid.")}get hasKey(){return null!==this.key}hasModifier(e){return this.modifiers.includes(e)}get casterType(){if([String,Boolean,Number].includes(this.caster))return h.PRIMITIVE;if(this.caster instanceof f)return h.DESCRIPTOR;if(this.caster instanceof Function)return h.FACTORY;throw new Error("Caster is not set.")}get hasMutator(){return"function"==typeof this.mutator}checkIsReady(){r(this.ejected,"Descriptor has not been ejected."),this.checkType(),this.checkCaster()}get hasDefault(){return void 0!==this.defaultValue}eject(){return this.ejected?this:new f(this.type,this.defaultValue,!0)}}const d=new f(a.ANY),p=new f(a.STRING),y=new f(a.NUMBER),R=new f(a.BOOLEAN),A=new f(a.ARRAY),T=e=>new u(e);e.$Any=d,e.$Boolean=R,e.$Many=A,e.$Number=y,e.$String=p,e.Blueprint=u,e.IllegalModifierError=n,e.MissingKeyError=i,e.blueprint=T,e.factory=e=>t=>T(e).make(t),Object.defineProperty(e,"__esModule",{value:!0})}));
